

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dipplanner.model.buhlmann.model &mdash; dipplanner 0.3a-11-gcf71 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.3a-11-gcf71',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="dipplanner 0.3a-11-gcf71 documentation" href="../../../../index.html" />
    <link rel="up" title="dipplanner" href="../../../dipplanner.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">dipplanner 0.3a-11-gcf71 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../dipplanner.html" accesskey="U">dipplanner</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for dipplanner.model.buhlmann.model</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Copyright 2011-2012 Thomas Chiroux</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as</span>
<span class="c"># published by the Free Software Foundation, either version 3 of the</span>
<span class="c"># License, or (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.</span>
<span class="c"># If not, see &lt;http://www.gnu.org/licenses/gpl.html&gt;</span>
<span class="c">#</span>
<span class="c"># This module is part of dipplanner, a Dive planning Tool written in python</span>

<span class="sd">&quot;&quot;&quot;Buhlmann model module</span>

<span class="sd">Contains:</span>
<span class="sd">Model -- class</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__authors__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># alphabetical order by last name</span>
    <span class="s">&#39;Thomas Chiroux&#39;</span><span class="p">,</span> <span class="p">]</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="c"># local imports</span>
<span class="kn">from</span> <span class="nn">dipplanner</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">dipplanner.model.buhlmann.compartment</span> <span class="kn">import</span> <span class="n">Compartment</span>
<span class="kn">from</span> <span class="nn">dipplanner.model.buhlmann.gradient</span> <span class="kn">import</span> <span class="n">Gradient</span>
<span class="kn">from</span> <span class="nn">dipplanner.model.buhlmann.oxygen_toxicity</span> <span class="kn">import</span> <span class="n">OxTox</span>
<span class="kn">from</span> <span class="nn">dipplanner</span> <span class="kn">import</span> <span class="n">tools</span>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a Buhlmann model.</span>
<span class="sd">    Composed of a tissue array of Compartment[]</span>
<span class="sd">    Has an OxTox and Gradient object</span>
<span class="sd">    Can throw a ModelStateException propagated from a Compartment if pressures</span>
<span class="sd">    or time is out of bounds.</span>

<span class="sd">    Models are initialised by initModel() if they are new models, or</span>
<span class="sd">    validated by validateModel() if they are rebuild from a saved model.</span>

<span class="sd">    The model is capable of ascending or descending via ascDec() using the</span>
<span class="sd">    ascDec() method of Compartment,</span>
<span class="sd">    or accounting for a constant depth using the</span>
<span class="sd">    constDepth() method of Compartment.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    tissues -- a list of Compartments</span>
<span class="sd">    gradient -- gradient factor object</span>
<span class="sd">    ox_tox -- OxTox object</span>
<span class="sd">    metadata -- Stores information about where the model was created</span>
<span class="sd">    units -- only &#39;metric&#39; allowed</span>
<span class="sd">    COMPS -- static info : number of compartments</span>
<span class="sd">    MODEL_VALIDATION_SUCCESS -- static const for success of validation</span>
<span class="sd">    MODEL_VALIDATION_FAILURE -- sattic const for failure of validation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">COMPS</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="c">#TODO: SUPPRIMER CES DEUX ELEMENTS ET REMPLACER PAR DES RAISE</span>
    <span class="n">MODEL_VALIDATION_SUCCESS</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">MODEL_VALIDATION_FAILURE</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Model.__init__"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for model class</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        &lt;none&gt;</span>

<span class="sd">        Returns:</span>
<span class="sd">        &lt;nothing&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#initiate class logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span>
            <span class="s">&quot;dipplanner.model.buhlmann.model.Model&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;creating an instance of Model&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;metric&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span> <span class="o">=</span> <span class="n">OxTox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_gradient</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">comp_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMPS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Compartment</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_time_constants</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">:</span>
            <span class="n">comp</span><span class="o">.</span><span class="n">set_pp</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.79</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span> <span class="o">-</span>
                         <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">)))</span>
            <span class="c">#TODO: Check above : 0.79 or settings.DEFAULT_AIR_PPN2 (tdb) ?</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s">&quot;(none)&quot;</span>
</div>
<div class="viewcode-block" id="Model.__deepcopy__"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.__deepcopy__">[docs]</a>    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;deepcopy method will be called by copy.deepcopy&quot;&quot;&quot;</span>
        <span class="n">newobj</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
        <span class="n">newobj</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
        <span class="n">newobj</span><span class="o">.</span><span class="n">ox_tox</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span><span class="p">)</span>
        <span class="n">newobj</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="p">)</span>
        <span class="n">newobj</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">)):</span>
            <span class="n">newobj</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">newobj</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a string representing the model&quot;&quot;&quot;</span>
        <span class="n">model_string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>  <span class="c"># &quot;Compartment pressures:\n&quot;</span>
        <span class="k">for</span> <span class="n">comp_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMPS</span><span class="p">):</span>
            <span class="n">model_string</span> <span class="o">+=</span> <span class="s">&quot;C:</span><span class="si">%s</span><span class="s"> He:</span><span class="si">%s</span><span class="s"> N2:</span><span class="si">%s</span><span class="s"> gf:</span><span class="si">%s</span><span class="s"> </span><span class="se">\</span>
<span class="s">mv_at:</span><span class="si">%s</span><span class="s"> max_amb:</span><span class="si">%s</span><span class="s"> MV:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">comp_number</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">comp_number</span><span class="p">]</span><span class="o">.</span><span class="n">pp_he</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">comp_number</span><span class="p">]</span><span class="o">.</span><span class="n">pp_n2</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">gf</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">comp_number</span><span class="p">]</span><span class="o">.</span><span class="n">get_m_value_at</span><span class="p">(</span>
                     <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span><span class="p">),</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">comp_number</span><span class="p">]</span><span class="o">.</span><span class="n">get_max_amb</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">gf</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">comp_number</span><span class="p">]</span><span class="o">.</span><span class="n">get_mv</span><span class="p">(</span>
                     <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span><span class="p">))</span>
        <span class="c">#model_string += &quot;Ceiling: %s\n&quot; % self.ceiling()</span>
        <span class="c">#model_string += &quot;Max surface M-Value: %s\n&quot; % self.m_value(0.0)</span>
        <span class="c">#model_string += &quot;OTUs accumulated: %s&quot; % self.ox_tox.otu</span>
        <span class="k">return</span> <span class="n">model_string</span>

<div class="viewcode-block" id="Model.__str__"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a human readable name of the segment&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Model.__unicode__"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.__unicode__">[docs]</a>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a human readable name of the segment in unicode&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Model.init_gradient"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.init_gradient">[docs]</a>    <span class="k">def</span> <span class="nf">init_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise the gradient attribute</span>
<span class="sd">        uses the default settings parameters for gf_low and high</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        &lt;none&gt;</span>

<span class="sd">        Returns:</span>
<span class="sd">        &lt;nothing&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">Gradient</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">GF_LOW</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">GF_HIGH</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Model.set_time_constants"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.set_time_constants">[docs]</a>    <span class="k">def</span> <span class="nf">set_time_constants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize time constants in buhmann tissue list</span>
<span class="sd">        Only for metric values</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        &lt;none&gt;</span>

<span class="sd">        Returns:</span>
<span class="sd">        &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># note: comparing with buhlmann original (1990) ZH-L16 a coeficient,</span>
        <span class="c"># there is here a x10 factor for a coeficient</span>
        <span class="c">#h_he, h_n2, a_he, b_he, a_n2, b_n2</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DECO_MODEL</span> <span class="o">==</span> <span class="s">&quot;ZHL16c&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;model used: Buhlmann ZHL16c&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">1.88</span><span class="p">,</span>    <span class="mf">5.0</span><span class="p">,</span>    <span class="mf">16.189</span><span class="p">,</span> <span class="mf">0.4770</span><span class="p">,</span> <span class="mf">11.696</span><span class="p">,</span> <span class="mf">0.5578</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">3.02</span><span class="p">,</span>    <span class="mf">8.0</span><span class="p">,</span>    <span class="mf">13.83</span><span class="p">,</span>  <span class="mf">0.5747</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span>   <span class="mf">0.6514</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">4.72</span><span class="p">,</span>    <span class="mf">12.5</span><span class="p">,</span>   <span class="mf">11.919</span><span class="p">,</span> <span class="mf">0.6527</span><span class="p">,</span> <span class="mf">8.618</span><span class="p">,</span>  <span class="mf">0.7222</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">6.99</span><span class="p">,</span>    <span class="mf">18.5</span><span class="p">,</span>   <span class="mf">10.458</span><span class="p">,</span> <span class="mf">0.7223</span><span class="p">,</span> <span class="mf">7.562</span><span class="p">,</span>  <span class="mf">0.7825</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">10.21</span><span class="p">,</span>   <span class="mf">27.0</span><span class="p">,</span>   <span class="mf">9.220</span><span class="p">,</span>  <span class="mf">0.7582</span><span class="p">,</span> <span class="mf">6.667</span><span class="p">,</span>  <span class="mf">0.8126</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">14.48</span><span class="p">,</span>   <span class="mf">38.3</span><span class="p">,</span>   <span class="mf">8.205</span><span class="p">,</span>  <span class="mf">0.7957</span><span class="p">,</span> <span class="mf">5.60</span><span class="p">,</span>   <span class="mf">0.8434</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">20.53</span><span class="p">,</span>   <span class="mf">54.3</span><span class="p">,</span>   <span class="mf">7.305</span><span class="p">,</span>  <span class="mf">0.8279</span><span class="p">,</span> <span class="mf">4.947</span><span class="p">,</span>  <span class="mf">0.8693</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">29.11</span><span class="p">,</span>   <span class="mf">77.0</span><span class="p">,</span>   <span class="mf">6.502</span><span class="p">,</span>  <span class="mf">0.8553</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span>    <span class="mf">0.8910</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">41.20</span><span class="p">,</span>   <span class="mf">109.0</span><span class="p">,</span>  <span class="mf">5.950</span><span class="p">,</span>  <span class="mf">0.8757</span><span class="p">,</span> <span class="mf">4.187</span><span class="p">,</span>  <span class="mf">0.9092</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">55.19</span><span class="p">,</span>   <span class="mf">146.0</span><span class="p">,</span>  <span class="mf">5.545</span><span class="p">,</span>  <span class="mf">0.8903</span><span class="p">,</span> <span class="mf">3.798</span><span class="p">,</span>  <span class="mf">0.9222</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">70.69</span><span class="p">,</span>  <span class="mf">187.0</span><span class="p">,</span>  <span class="mf">5.333</span><span class="p">,</span>  <span class="mf">0.8997</span><span class="p">,</span> <span class="mf">3.497</span><span class="p">,</span>  <span class="mf">0.9319</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">90.34</span><span class="p">,</span>  <span class="mf">239.0</span><span class="p">,</span>  <span class="mf">5.189</span><span class="p">,</span>  <span class="mf">0.9073</span><span class="p">,</span> <span class="mf">3.223</span><span class="p">,</span>  <span class="mf">0.9403</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">115.29</span><span class="p">,</span> <span class="mf">305.0</span><span class="p">,</span>  <span class="mf">5.181</span><span class="p">,</span>  <span class="mf">0.9122</span><span class="p">,</span> <span class="mf">2.850</span><span class="p">,</span>  <span class="mf">0.9477</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">147.42</span><span class="p">,</span> <span class="mf">390.0</span><span class="p">,</span>  <span class="mf">5.176</span><span class="p">,</span>  <span class="mf">0.9171</span><span class="p">,</span> <span class="mf">2.737</span><span class="p">,</span>  <span class="mf">0.9544</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">188.24</span><span class="p">,</span> <span class="mf">498.0</span><span class="p">,</span>  <span class="mf">5.172</span><span class="p">,</span>  <span class="mf">0.9217</span><span class="p">,</span> <span class="mf">2.523</span><span class="p">,</span>  <span class="mf">0.9602</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">240.03</span><span class="p">,</span> <span class="mf">635.0</span><span class="p">,</span>  <span class="mf">5.119</span><span class="p">,</span>  <span class="mf">0.9267</span><span class="p">,</span> <span class="mf">2.327</span><span class="p">,</span>  <span class="mf">0.9653</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">settings</span><span class="o">.</span><span class="n">DECO_MODEL</span> <span class="o">==</span> <span class="s">&quot;ZHL16b&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;model used: Buhlmann ZHL16b&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">1.88</span><span class="p">,</span>    <span class="mf">5.0</span><span class="p">,</span>    <span class="mf">16.189</span><span class="p">,</span> <span class="mf">0.4770</span><span class="p">,</span> <span class="mf">11.696</span><span class="p">,</span> <span class="mf">0.5578</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">3.02</span><span class="p">,</span>    <span class="mf">8.0</span><span class="p">,</span>    <span class="mf">13.83</span><span class="p">,</span>  <span class="mf">0.5747</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span>   <span class="mf">0.6514</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">4.72</span><span class="p">,</span>    <span class="mf">12.5</span><span class="p">,</span>   <span class="mf">11.919</span><span class="p">,</span> <span class="mf">0.6527</span><span class="p">,</span> <span class="mf">8.618</span><span class="p">,</span>  <span class="mf">0.7222</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">6.99</span><span class="p">,</span>    <span class="mf">18.5</span><span class="p">,</span>   <span class="mf">10.458</span><span class="p">,</span> <span class="mf">0.7223</span><span class="p">,</span> <span class="mf">7.562</span><span class="p">,</span>  <span class="mf">0.7825</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">10.21</span><span class="p">,</span>   <span class="mf">27.0</span><span class="p">,</span>   <span class="mf">9.220</span><span class="p">,</span>  <span class="mf">0.7582</span><span class="p">,</span> <span class="mf">6.667</span><span class="p">,</span>  <span class="mf">0.8126</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">14.48</span><span class="p">,</span>   <span class="mf">38.3</span><span class="p">,</span>   <span class="mf">8.205</span><span class="p">,</span>  <span class="mf">0.7957</span><span class="p">,</span> <span class="mf">5.933</span><span class="p">,</span>   <span class="mf">0.8434</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">20.53</span><span class="p">,</span>   <span class="mf">54.3</span><span class="p">,</span>   <span class="mf">7.305</span><span class="p">,</span>  <span class="mf">0.8279</span><span class="p">,</span> <span class="mf">5.282</span><span class="p">,</span>  <span class="mf">0.8693</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">29.11</span><span class="p">,</span>   <span class="mf">77.0</span><span class="p">,</span>   <span class="mf">6.502</span><span class="p">,</span>  <span class="mf">0.8553</span><span class="p">,</span> <span class="mf">4.71</span><span class="p">,</span>    <span class="mf">0.8910</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">41.20</span><span class="p">,</span>   <span class="mf">109.0</span><span class="p">,</span>  <span class="mf">5.950</span><span class="p">,</span>  <span class="mf">0.8757</span><span class="p">,</span> <span class="mf">4.187</span><span class="p">,</span>  <span class="mf">0.9092</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">55.19</span><span class="p">,</span>   <span class="mf">146.0</span><span class="p">,</span>  <span class="mf">5.545</span><span class="p">,</span>  <span class="mf">0.8903</span><span class="p">,</span> <span class="mf">3.798</span><span class="p">,</span>  <span class="mf">0.9222</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">70.69</span><span class="p">,</span>  <span class="mf">187.0</span><span class="p">,</span>  <span class="mf">5.333</span><span class="p">,</span>  <span class="mf">0.8997</span><span class="p">,</span> <span class="mf">3.497</span><span class="p">,</span>  <span class="mf">0.9319</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">90.34</span><span class="p">,</span>  <span class="mf">239.0</span><span class="p">,</span>  <span class="mf">5.189</span><span class="p">,</span>  <span class="mf">0.9073</span><span class="p">,</span> <span class="mf">3.223</span><span class="p">,</span>  <span class="mf">0.9403</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">115.29</span><span class="p">,</span> <span class="mf">305.0</span><span class="p">,</span>  <span class="mf">5.181</span><span class="p">,</span>  <span class="mf">0.9122</span><span class="p">,</span> <span class="mf">2.971</span><span class="p">,</span>  <span class="mf">0.9477</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">147.42</span><span class="p">,</span> <span class="mf">390.0</span><span class="p">,</span>  <span class="mf">5.176</span><span class="p">,</span>  <span class="mf">0.9171</span><span class="p">,</span> <span class="mf">2.737</span><span class="p">,</span>  <span class="mf">0.9544</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">188.24</span><span class="p">,</span> <span class="mf">498.0</span><span class="p">,</span>  <span class="mf">5.172</span><span class="p">,</span>  <span class="mf">0.9217</span><span class="p">,</span> <span class="mf">2.523</span><span class="p">,</span>  <span class="mf">0.9602</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set_compartment_time_constants</span><span class="p">(</span>
                <span class="mf">240.03</span><span class="p">,</span> <span class="mf">635.0</span><span class="p">,</span>  <span class="mf">5.119</span><span class="p">,</span>  <span class="mf">0.9267</span><span class="p">,</span> <span class="mf">2.327</span><span class="p">,</span>  <span class="mf">0.9653</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Model.validate_model"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.validate_model">[docs]</a>    <span class="k">def</span> <span class="nf">validate_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate model - checks over the model and looks for corruption</span>
<span class="sd">        This is needed to chack a model that has been loaded from XML</span>
<span class="sd">        Resets time constants</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        &lt;none&gt;</span>

<span class="sd">        Returns:</span>
<span class="sd">        self.MODEL_VALIDATION_SUCCESS -- if OK</span>
<span class="sd">        self.MODEL_VALIDATION_FAILURE -- if not OK</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_constant_zero</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c"># need for resetting time constants</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">comp</span><span class="o">.</span><span class="n">pp_n2</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_VALIDATION_FAILURE</span>
            <span class="k">if</span> <span class="n">comp</span><span class="o">.</span><span class="n">pp_he</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_VALIDATION_FAILURE</span>
            <span class="k">if</span> <span class="n">comp</span><span class="o">.</span><span class="n">k_he</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> \
                    <span class="n">comp</span><span class="o">.</span><span class="n">k_n2</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> \
                    <span class="n">comp</span><span class="o">.</span><span class="n">a_he</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> \
                    <span class="n">comp</span><span class="o">.</span><span class="n">b_he</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> \
                    <span class="n">comp</span><span class="o">.</span><span class="n">a_n2</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> \
                    <span class="n">comp</span><span class="o">.</span><span class="n">b_n2</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">time_constant_zero</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">time_constant_zero</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_time_constants</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_VALIDATION_SUCCESS</span>
</div>
<div class="viewcode-block" id="Model.control_compartment"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.control_compartment">[docs]</a>    <span class="k">def</span> <span class="nf">control_compartment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the controlling compartment at ceiling (1-16)</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            integer : reference number of the controlling</span>
<span class="sd">                      compartment (between 1 to 16)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control_compartment_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_pressure</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">comp_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMPS</span><span class="p">):</span>
            <span class="n">pressure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">[</span><span class="n">comp_number</span><span class="p">]</span><span class="o">.</span><span class="n">get_max_amb</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">gf</span><span class="p">)</span> <span class="o">-</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
            <span class="c">#self.logger.debug(&quot;pressure:%s&quot; % pressure)</span>
            <span class="k">if</span> <span class="n">pressure</span> <span class="o">&gt;</span> <span class="n">max_pressure</span><span class="p">:</span>
                <span class="n">control_compartment_number</span> <span class="o">=</span> <span class="n">comp_number</span>
                <span class="n">max_pressure</span> <span class="o">=</span> <span class="n">pressure</span>
        <span class="k">return</span> <span class="n">control_compartment_number</span> <span class="o">+</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Model.ceiling"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.ceiling">[docs]</a>    <span class="k">def</span> <span class="nf">ceiling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the current ceiling depth</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        &lt;none&gt;</span>

<span class="sd">        Returns:</span>
<span class="sd">        Float, ceiling depth in meter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">:</span>
            <span class="c">#Get compartment tolerated ambient pressure and convert from</span>
            <span class="c"># absolute pressure to depth</span>
            <span class="n">comp_pressure</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_max_amb</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">gf</span><span class="p">)</span> <span class="o">-</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
            <span class="k">if</span> <span class="n">comp_pressure</span> <span class="o">&gt;</span> <span class="n">pressure</span><span class="p">:</span>
                <span class="n">pressure</span> <span class="o">=</span> <span class="n">comp_pressure</span>
        <span class="k">return</span> <span class="n">tools</span><span class="o">.</span><span class="n">pressure_to_depth</span><span class="p">(</span><span class="n">pressure</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Model.ceiling_in_pabs"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.ceiling_in_pabs">[docs]</a>    <span class="k">def</span> <span class="nf">ceiling_in_pabs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the current ceiling</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        &lt;none&gt;</span>

<span class="sd">        Returns:</span>
<span class="sd">        Float, ceiling in bar (absolute pressure)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">:</span>
            <span class="c">#Get compartment tolerated ambient pressure and convert from</span>
            <span class="c">#absolute pressure to depth</span>
            <span class="n">comp_pressure</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_max_amb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">gf</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comp_pressure</span> <span class="o">&gt;</span> <span class="n">pressure</span><span class="p">:</span>
                <span class="n">pressure</span> <span class="o">=</span> <span class="n">comp_pressure</span>
        <span class="k">return</span> <span class="n">pressure</span>
</div>
<div class="viewcode-block" id="Model.m_value"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.m_value">[docs]</a>    <span class="k">def</span> <span class="nf">m_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pressure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the maximum M-Value for a given depth (pressure)</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        pressure -- in bar</span>

<span class="sd">        Returns</span>
<span class="sd">        float, max M-Value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_absolute</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">+</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
        <span class="n">compartment_mv</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">max_mv</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">:</span>
            <span class="n">compartment_mv</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_mv</span><span class="p">(</span><span class="n">p_absolute</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">compartment_mv</span> <span class="o">&gt;</span> <span class="n">max_mv</span><span class="p">:</span>
                <span class="n">max_mv</span> <span class="o">=</span> <span class="n">compartment_mv</span>
        <span class="c">#self.logger.debug(&quot;max mv : %s&quot; % max_mv)</span>
        <span class="k">return</span> <span class="n">max_mv</span>
</div>
<div class="viewcode-block" id="Model.const_depth"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.const_depth">[docs]</a>    <span class="k">def</span> <span class="nf">const_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">seg_time</span><span class="p">,</span> <span class="n">f_he</span><span class="p">,</span> <span class="n">f_n2</span><span class="p">,</span> <span class="n">pp_o2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constant depth profile.</span>
<span class="sd">        Calls Compartment.constDepth for each compartment to update the model.</span>

<span class="sd">        *Keyword arguments:*</span>

<span class="sd">            :pressure: -- pressure of this depth of segment in bar</span>
<span class="sd">            :seg_time: -- Time of segment in seconds</span>
<span class="sd">            :f_he: -- Fraction of inert gas Helium in inspired gas mix</span>
<span class="sd">            :f_n2: -- Fraction of inert gas Nitrogen in inspired gas mix</span>
<span class="sd">            :pp_o2: -- For CCR mode, partial pressure of oxygen in bar.</span>
<span class="sd">                       If == 0.0, then open circuit</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            ModelStateException</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ambiant_pressure</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">+</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
        <span class="k">if</span> <span class="n">pp_o2</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="c"># CCR mode</span>
            <span class="c">#Determine pInert by subtracting absolute oxygen pressure and pH2O</span>
            <span class="c">#Note that if f_he and f_n2 == 0.0 then need to force pp&#39;s to zero</span>
            <span class="k">if</span> <span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">p_inert</span> <span class="o">=</span> <span class="n">ambiant_pressure</span> <span class="o">-</span> <span class="n">pp_o2</span> <span class="o">-</span> \
                    <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_inert</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c">#Verify that pInert is positive. If the setpoint is close to or</span>
            <span class="c"># less than the depth then there is no inert gas.</span>
            <span class="k">if</span> <span class="n">p_inert</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">pp_he_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_inert</span> <span class="o">*</span> <span class="n">f_he</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span><span class="p">)</span>
                <span class="n">pp_n2_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_inert</span> <span class="o">*</span> <span class="n">f_n2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pp_he_inspired</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">pp_n2_inspired</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c"># update OxTox object</span>
            <span class="n">pp_o2_inspired</span> <span class="o">=</span> <span class="n">pp_o2</span>
            <span class="c">#Check that ppO2Inspired is not greater than the depth.</span>
            <span class="c">#This occurs in shallow deco when the setpoint specified is &gt; depth</span>
            <span class="k">if</span> <span class="n">pp_o2_inspired</span> <span class="o">&lt;=</span> <span class="n">ambiant_pressure</span> <span class="ow">and</span> <span class="n">p_inert</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="c"># pp_o2 is the setpoint</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span><span class="o">.</span><span class="n">add_o2</span><span class="p">(</span><span class="n">seg_time</span><span class="p">,</span> <span class="n">pp_o2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># pp_o2 is equal to the depth, also true is there is</span>
                <span class="c"># no inert gaz</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span><span class="o">.</span><span class="n">add_o2</span><span class="p">(</span><span class="n">seg_time</span><span class="p">,</span> <span class="n">ambiant_pressure</span> <span class="o">-</span>
                                   <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span>
                                       <span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># OC mode</span>
            <span class="n">pp_he_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">ambiant_pressure</span> <span class="o">-</span>
                              <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span>
                                  <span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">))</span> <span class="o">*</span> <span class="n">f_he</span>
            <span class="n">pp_n2_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">ambiant_pressure</span> <span class="o">-</span>
                              <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span>
                                  <span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">))</span> <span class="o">*</span> <span class="n">f_n2</span>
            <span class="c"># update ox_tox</span>
            <span class="k">if</span> <span class="n">pressure</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>  <span class="c"># surface</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span><span class="o">.</span><span class="n">remove_o2</span><span class="p">(</span><span class="n">seg_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span><span class="o">.</span><span class="n">add_o2</span><span class="p">(</span>
                    <span class="n">seg_time</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">ambiant_pressure</span> <span class="o">-</span>
                     <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">))</span>
                    <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">f_he</span> <span class="o">-</span> <span class="n">f_n2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">seg_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">:</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">const_depth</span><span class="p">(</span><span class="n">pp_he_inspired</span><span class="p">,</span> <span class="n">pp_n2_inspired</span><span class="p">,</span> <span class="n">seg_time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Model.asc_desc"><a class="viewcode-back" href="../../../../autodoc.html#dipplanner.model.buhlmann.model.Model.asc_desc">[docs]</a>    <span class="k">def</span> <span class="nf">asc_desc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">f_he</span><span class="p">,</span> <span class="n">f_n2</span><span class="p">,</span> <span class="n">pp_o2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ascend/Descend profile.</span>
<span class="sd">        Calls Compartment.asc_desc to update compartments</span>

<span class="sd">        *Keyword arguments:*</span>

<span class="sd">        :start: -- start pressure of this segment in bar (WARNING: not meter !)</span>
<span class="sd">        :finish: -- finish pressure of this segment in bar (WARNING: not meter !)</span>
<span class="sd">        :rate: -- rate of ascent or descent in m/s</span>
<span class="sd">        :f_he: -- Fraction of inert gas Helium in inspired gas mix</span>
<span class="sd">        :f_n2: -- Fraction of inert gas Nitrogen in inspired gas mix</span>
<span class="sd">        :pp_o2: -- For CCR mode, partial pressure of oxygen in bar.</span>
<span class="sd">            If == 0.0, then open circuit</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            ModelStateException</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># rem: here we do not bother of PP_H2O like in constant_depth : WHY ?</span>
        <span class="n">start_ambiant_pressure</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
        <span class="n">finish_ambiant_pressure</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">+</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
        <span class="n">seg_time</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">finish</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">))</span> <span class="o">/</span> <span class="n">rate</span>
        <span class="k">if</span> <span class="n">pp_o2</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="c"># CCR mode</span>
            <span class="c"># Calculate inert gas partial pressure == pAmb - pO2 - pH2O</span>
            <span class="n">p_inert_start</span> <span class="o">=</span> <span class="n">start_ambiant_pressure</span> <span class="o">-</span> <span class="n">pp_o2</span> <span class="o">-</span> \
                <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">)</span>
            <span class="n">p_inert_finish</span> <span class="o">=</span> <span class="n">finish_ambiant_pressure</span> <span class="o">-</span> <span class="n">pp_o2</span> <span class="o">-</span> \
                <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">)</span>
            <span class="c"># Check that it doesn&#39;t go less than zero.</span>
            <span class="c"># Could be due to shallow deco or starting on high setpoint</span>
            <span class="k">if</span> <span class="n">p_inert_start</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">p_inert_start</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">p_inert_finish</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">p_inert_finish</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c"># Separate into He and N2 components, checking that we are not</span>
            <span class="c"># on pure O2 (or we get an arithmetic error)</span>
            <span class="k">if</span> <span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">pp_he_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_inert_start</span> <span class="o">*</span> <span class="n">f_he</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span><span class="p">)</span>
                <span class="n">pp_n2_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_inert_start</span> <span class="o">*</span> <span class="n">f_n2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span><span class="p">)</span>
                <span class="c"># calculate rate of change of each inert gas</span>
                <span class="n">rate_he</span> <span class="o">=</span> <span class="p">((</span><span class="n">p_inert_finish</span> <span class="o">*</span> <span class="n">f_he</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span><span class="p">)</span> <span class="o">-</span>
                           <span class="n">pp_he_inspired</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">seg_time</span><span class="p">)</span>
                <span class="n">rate_n2</span> <span class="o">=</span> <span class="p">((</span><span class="n">p_inert_finish</span> <span class="o">*</span> <span class="n">f_n2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_he</span> <span class="o">+</span> <span class="n">f_n2</span><span class="p">)</span> <span class="o">-</span>
                           <span class="n">pp_n2_inspired</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">seg_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pp_he_inspired</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">pp_n2_inspired</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">rate_he</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">rate_n2</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c"># update ox_tox, constant pp_o2</span>
            <span class="c"># TODO - what if depth is less than pO2 in msw ?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span><span class="o">.</span><span class="n">add_o2</span><span class="p">(</span><span class="n">seg_time</span><span class="p">,</span> <span class="n">pp_o2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># OC mode</span>
            <span class="c"># calculate He and N2 components</span>
            <span class="n">pp_he_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_ambiant_pressure</span> <span class="o">-</span>
                              <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span>
                                  <span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">))</span> <span class="o">*</span> <span class="n">f_he</span>
            <span class="n">pp_n2_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_ambiant_pressure</span> <span class="o">-</span>
                              <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span>
                                  <span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">))</span> <span class="o">*</span> <span class="n">f_n2</span>
            <span class="n">rate_he</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="n">f_he</span>
            <span class="n">rate_n2</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="n">f_n2</span>
            <span class="c"># update ox_tox, use average pp_o2</span>
            <span class="n">pp_o2_inspired_avg</span> <span class="o">=</span> <span class="p">((</span><span class="n">start_ambiant_pressure</span> <span class="o">-</span>
                                   <span class="n">finish_ambiant_pressure</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                                  <span class="o">+</span> <span class="n">finish_ambiant_pressure</span> <span class="o">-</span>
                                  <span class="n">tools</span><span class="o">.</span><span class="n">calculate_pp_h2o_surf</span><span class="p">(</span>
                                      <span class="n">settings</span><span class="o">.</span><span class="n">SURFACE_TEMP</span><span class="p">))</span> \
                <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">f_he</span> <span class="o">-</span> <span class="n">f_n2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ox_tox</span><span class="o">.</span><span class="n">add_o2</span><span class="p">(</span><span class="n">seg_time</span><span class="p">,</span> <span class="n">pp_o2_inspired_avg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissues</span><span class="p">:</span>
            <span class="n">comp</span><span class="o">.</span><span class="n">asc_desc</span><span class="p">(</span><span class="n">pp_he_inspired</span><span class="p">,</span> <span class="n">pp_n2_inspired</span><span class="p">,</span>
                          <span class="n">rate_he</span><span class="p">,</span> <span class="n">rate_n2</span><span class="p">,</span> <span class="n">seg_time</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">dipplanner 0.3a-11-gcf71 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../dipplanner.html" >dipplanner</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2012, Thomas Chiroux.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>