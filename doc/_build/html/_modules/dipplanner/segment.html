

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dipplanner.segment &mdash; dipplanner 0.3a-11-gcf71 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3a-11-gcf71',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="dipplanner 0.3a-11-gcf71 documentation" href="../../index.html" />
    <link rel="up" title="dipplanner" href="../dipplanner.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">dipplanner 0.3a-11-gcf71 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../dipplanner.html" accesskey="U">dipplanner</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for dipplanner.segment</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Copyright 2011-2012 Thomas Chiroux</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as</span>
<span class="c"># published by the Free Software Foundation, either version 3 of the</span>
<span class="c"># License, or (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.</span>
<span class="c"># If not, see &lt;http://www.gnu.org/licenses/gpl.html&gt;</span>
<span class="c">#</span>
<span class="c"># This module is part of dipplanner, a Dive planning Tool written in python</span>

<span class="sd">&quot;&quot;&quot;Segment classes</span>
<span class="sd">A segment is a portion of a dive in the same depth (depth + duration)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__authors__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># alphabetical order by last name</span>
    <span class="s">&#39;Thomas Chiroux&#39;</span><span class="p">,</span> <span class="p">]</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="c"># local import</span>
<span class="kn">from</span> <span class="nn">dipplanner</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">dipplanner.dipp_exception</span> <span class="kn">import</span> <span class="n">DipplannerException</span>
<span class="kn">from</span> <span class="nn">dipplanner.tools</span> <span class="kn">import</span> <span class="n">seconds_to_mmss</span>
<span class="kn">from</span> <span class="nn">dipplanner.tools</span> <span class="kn">import</span> <span class="n">depth_to_pressure</span><span class="p">,</span> <span class="n">pressure_to_depth</span>


<div class="viewcode-block" id="UnauthorizedMod"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.UnauthorizedMod">[docs]</a><span class="k">class</span> <span class="nc">UnauthorizedMod</span><span class="p">(</span><span class="n">DipplannerException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;raised when the MOD is not possible according to the</span>
<span class="sd">    depth(s) of the segment&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnauthorizedMod.__init__"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.UnauthorizedMod.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;constructor : call the upper constructor and set the logger</span>

<span class="sd">        *Keyword Arguments:*</span>
<span class="sd">            :description: (str) -- text describing the error</span>

<span class="sd">        *Return:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DipplannerException</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span>
            <span class="s">&quot;dipplanner.DipplannerException.UnauthorizedMod&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s">&quot;Raising an exception: UnauthorizedMod ! (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">description</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Segment"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment">[docs]</a><span class="k">class</span> <span class="nc">Segment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all types of segments</span>

<span class="sd">    *Attributes:*</span>

<span class="sd">        * type (str) -- type of segment</span>

<span class="sd">          types of segments can be :</span>

<span class="sd">          * const = &quot;Constant Depth&quot;</span>
<span class="sd">          * ascent = &quot;Ascent&quot;</span>
<span class="sd">          * descent = &quot;Descent&quot;</span>
<span class="sd">          * deco = &quot;Decompression&quot;</span>
<span class="sd">          * waypoint = &quot;Waypoint&quot;</span>
<span class="sd">          * surf = &quot;Surface&quot;</span>
<span class="sd">        * in_use (boolean) -- True if segment is used</span>
<span class="sd">        * depth (float) -- depth of this segment, in meter</span>
<span class="sd">        * time (float) -- duration of this segment, in seconds</span>
<span class="sd">        * run_time (float) -- runtime in profile</span>
<span class="sd">        * setpoint (float) -- setpoint for CCR</span>
<span class="sd">        * tank (Tank) -- refer to tank object used in this segment</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;const&#39;</span><span class="p">,</span> <span class="s">&#39;ascent&#39;</span><span class="p">,</span> <span class="s">&#39;descent&#39;</span><span class="p">,</span> <span class="s">&#39;deco&#39;</span><span class="p">,</span> <span class="s">&#39;waypoint&#39;</span><span class="p">,</span> <span class="s">&#39;surf&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Segment.__init__"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;constructor for Segment base class, just defines all the parameters</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#initiate class logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;dipplanner.segment.Segment&quot;</span><span class="p">)</span>
        <span class="c">#self.logger.debug(&quot;creating an instance of Segment&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># type of segment : base class has no type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_use</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># is this segment in use : default: yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># depth of this segment, in meter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># time of this segment, in second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># runtime in profile (TODO: a priori inutile)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># for CCR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># tank used for this segment</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a string representing the actual segment</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            str -- representation of the segment in the form:</span>
<span class="sd">            &quot;   CONST: at 150m for  10:00 [RT:  0:00], on Trimix 10/70,  SP:0.0, END:61m&quot;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%8s</span><span class="s">: at </span><span class="si">%3d</span><span class="s">m for </span><span class="si">%s</span><span class="s"> [RT:</span><span class="si">%s</span><span class="s">], on </span><span class="si">%s</span><span class="s">,  SP:</span><span class="si">%s</span><span class="s">, END:</span><span class="si">%i</span><span class="s">m&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_time_str</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_run_time_str</span><span class="p">(),</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_end</span><span class="p">())</span>

<div class="viewcode-block" id="Segment.__str__"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a human readable name of the segment</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            str -- representation of the segment in the form:</span>
<span class="sd">            (see __repr__)</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Segment.__unicode__"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.__unicode__">[docs]</a>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a human readable name of the segment in unicode</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            str -- representation of the segment in the form:</span>
<span class="sd">            (see __repr__)</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Segment.check"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;check if it&#39;s a valid segment</span>
<span class="sd">        Should be executed before calculating dives</span>

<span class="sd">        the check does not return anything if nok, but raises Exceptions</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            True (bool) -- if check is ok</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;DiveExceptions&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># check MOD only if OC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_mod</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_min_od</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Segment.check_mod"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.check_mod">[docs]</a>    <span class="k">def</span> <span class="nf">check_mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">max_ppo2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;checks the mod for this segment according to the used tank.</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            :max_ppo2: (float) -- max tolerated ppo2</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            True (bool) -- if check is ok</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            UnauthorizedMod -- if segments goes below max mod or upper min mod</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_mod</span><span class="p">(</span><span class="n">max_ppo2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UnauthorizedMod</span><span class="p">(</span><span class="s">&quot;depth is exceeding the maximum MOD&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Segment.check_min_od"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.check_min_od">[docs]</a>    <span class="k">def</span> <span class="nf">check_min_od</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;checks the minimum od for this segment according to the used tank.</span>
<span class="sd">        (hypoxic cases)</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            True (bool) -- if check is ok</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            UnauthorizedMod -- if segments goes below max mod or upper min mod</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_min_od</span><span class="p">():</span>  <span class="c"># checks mini operating depth</span>
            <span class="k">raise</span> <span class="n">UnauthorizedMod</span><span class="p">(</span><span class="s">&quot;depth is too low for the minimum MOD&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Segment.get_time_str"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.get_time_str">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns segment time in the form MMM:SS</span>

<span class="sd">        *Keyword Arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            string -- segment time in the form MMM:SS</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">seconds_to_mmss</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Segment.get_run_time_str"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.get_run_time_str">[docs]</a>    <span class="k">def</span> <span class="nf">get_run_time_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns runtime in the form MMM:SS</span>

<span class="sd">        *Keyword Arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            string -- segment time in the form MMM:SS</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">seconds_to_mmss</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Segment.get_p_absolute"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.get_p_absolute">[docs]</a>    <span class="k">def</span> <span class="nf">get_p_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">METHOD_FOR_DEPTH_CALCULATION</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the absolute pression in bar</span>
<span class="sd">        (1atm = 1ATA = 1.01325 bar = 14.70psi)</span>

<span class="sd">        Simple method : 10m = +1 bar</span>
<span class="sd">        Complex method : use real density of water, TÂ°, etc...</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            method -- &#39;simple&#39; or &#39;complex&#39;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            float -- indicating the absolute pressure in bar</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            ValueError -- when providing a bad method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;complex&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">depth_to_pressure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">+</span> \
                <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;invalid method of calculation&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Segment.get_end"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.get_end">[docs]</a>    <span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates and returns E.N.D :</span>
<span class="sd">        Equivalent Narcosis Depth</span>

<span class="sd">        Instead of Mvplan, it uses a &#39;calculation method&#39; based on</span>
<span class="sd">        narcosis effet of all gas used, assuming there is no trace of</span>
<span class="sd">        other gases (like argon) in the breathing gas, but compare the narcotic</span>
<span class="sd">        effect with surface gas, wich is &#39;air&#39; and contains</span>
<span class="sd">        a small amount of argon</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            integer -- Equivalent Narcosis Depth in meter</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            &lt;nothing&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#TODO: refactor with get_end_for_given_depth in Tank</span>
        <span class="n">p_absolute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_p_absolute</span><span class="p">()</span>
        <span class="c"># calculate the reference narcotic effect of air</span>
        <span class="c"># Air consists of: Nitrogen N2: 78.08%,</span>
        <span class="c">#                  Oxygen O2: 20.95%,</span>
        <span class="c">#                  Argon Ar: 0.934%</span>
        <span class="n">reference_narcotic</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">N2_NARCOTIC_VALUE</span> <span class="o">*</span> <span class="mf">0.7808</span> <span class="o">+</span>
             <span class="n">settings</span><span class="o">.</span><span class="n">O2_NARCOTIC_VALUE</span> <span class="o">*</span> <span class="mf">0.2095</span> <span class="o">+</span>
             <span class="n">settings</span><span class="o">.</span><span class="n">AR_NARCOTIC_VALUE</span> <span class="o">*</span> <span class="mf">0.00934</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">#CCR mode</span>
            <span class="n">f_inert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">f_he</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">f_n2</span>
            <span class="k">if</span> <span class="n">f_inert</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pp_inert</span> <span class="o">=</span> <span class="n">p_absolute</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pp_inert</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">pp_inert</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># sort of approximation here ?</span>
                <span class="c"># calculate here a narcotic index based on the proportion</span>
                <span class="c"># of innertgases in the dilluent tank</span>
                <span class="c"># should (perhaps) calculate based on proportion</span>
                <span class="c"># of innert gases inthe loop ?</span>
                <span class="n">ppn2_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">pp_inert</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">f_n2</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_inert</span>
                <span class="n">pphe_inspired</span> <span class="o">=</span> <span class="p">(</span><span class="n">pp_inert</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">f_he</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_inert</span>
                <span class="n">narcotic_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">ppn2_inspired</span> <span class="o">*</span> <span class="n">settings</span><span class="o">.</span><span class="n">N2_NARCOTIC_VALUE</span> <span class="o">+</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">*</span> <span class="n">settings</span><span class="o">.</span><span class="n">O2_NARCOTIC_VALUE</span> <span class="o">+</span>
                                  <span class="n">pphe_inspired</span> <span class="o">*</span> <span class="n">settings</span><span class="o">.</span><span class="n">HE_NARCOTIC_VALUE</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;pabs: </span><span class="si">%.3f</span><span class="s">, pp_inert: </span><span class="si">%.3f</span><span class="s"> at </span><span class="si">%s</span><span class="s">m, &quot;</span>
                                  <span class="s">&quot;ppn2i:</span><span class="si">%s</span><span class="s">, pphei:</span><span class="si">%s</span><span class="s">, narco idx:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                  <span class="p">(</span><span class="n">p_absolute</span><span class="p">,</span> <span class="n">pp_inert</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="n">ppn2_inspired</span><span class="p">,</span>
                                   <span class="n">pphe_inspired</span><span class="p">,</span> <span class="n">narcotic_index</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">narcotic_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#OC mode</span>
            <span class="n">narcotic_index</span> <span class="o">=</span> <span class="n">p_absolute</span> <span class="o">*</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">f_n2</span> <span class="o">*</span> <span class="n">settings</span><span class="o">.</span><span class="n">N2_NARCOTIC_VALUE</span> <span class="o">+</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">f_o2</span> <span class="o">*</span> <span class="n">settings</span><span class="o">.</span><span class="n">O2_NARCOTIC_VALUE</span> <span class="o">+</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">f_he</span> <span class="o">*</span> <span class="n">settings</span><span class="o">.</span><span class="n">HE_NARCOTIC_VALUE</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">pressure_to_depth</span><span class="p">(</span><span class="n">narcotic_index</span> <span class="o">/</span> <span class="n">reference_narcotic</span> <span class="o">-</span>
                                <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">end</span>
</div>
<div class="viewcode-block" id="Segment.gas_used"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.Segment.gas_used">[docs]</a>    <span class="k">def</span> <span class="nf">gas_used</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the quantity (in liter) of gas used for this segment</span>

<span class="sd">        (this method is empty)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

</div></div>
<div class="viewcode-block" id="SegmentDive"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentDive">[docs]</a><span class="k">class</span> <span class="nc">SegmentDive</span><span class="p">(</span><span class="n">Segment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specialisation of segment class for dive segments</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SegmentDive.__init__"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentDive.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tank</span><span class="p">,</span> <span class="n">setpoint</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for SegmentDive class.</span>
<span class="sd">        Look at base class for more explanations</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            :depth: (float) -- in meter, the (constant) depth for this segment</span>
<span class="sd">            :time: (float) -- in second, duration of this segment</span>
<span class="sd">            :tank: (Tank) -- object instance of Tank class :</span>
<span class="sd">                             describe the tank used in this segment</span>
<span class="sd">            :setpoint: (float) -- for CCR, setpoint used for this segment</span>
<span class="sd">                                  for OC : setpoint should be zero</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            UnauthorizedMod -- if depth is incompatible</span>
<span class="sd">                               with either min or max mod</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Segment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c">#initiate class logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;dipplanner.segment.SegmentDive&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;creating an instance of SegmentDive: </span><span class="se">\</span>
<span class="s">    depth:</span><span class="si">%s</span><span class="s">, time:</span><span class="si">%s</span><span class="s">s, tank:</span><span class="si">%s</span><span class="s">, sp:</span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tank</span><span class="p">,</span> <span class="n">setpoint</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;const&#39;</span>  <span class="c"># type of segment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_use</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># is this segment in use : default: yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>  <span class="c"># depth of this segment, in meter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>  <span class="c"># time of this segment, in second</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">setpoint</span><span class="p">)</span>  <span class="c"># for CCR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">tank</span>  <span class="c"># tank used for this segment</span>
</div>
<div class="viewcode-block" id="SegmentDive.gas_used"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentDive.gas_used">[docs]</a>    <span class="k">def</span> <span class="nf">gas_used</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;calculates returns the quantity (in liter)</span>
<span class="sd">        of gas used for this segment</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            float -- in liter, quantity of gas used</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># CCR mode: we do not calculate gas_used</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pressure</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth_to_pressure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pressure</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">*</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DIVE_CONSUMPTION_RATE</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="SegmentDeco"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentDeco">[docs]</a><span class="k">class</span> <span class="nc">SegmentDeco</span><span class="p">(</span><span class="n">Segment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specialisation of segment class for deco segments</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SegmentDeco.__init__"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentDeco.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tank</span><span class="p">,</span> <span class="n">setpoint</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for SegmentDeco class.</span>
<span class="sd">        Look at base class for more explanations</span>

<span class="sd">        In deco segment, we also have to manage some new parameters :</span>

<span class="sd">        * gf_used : which gradient factor is used</span>
<span class="sd">        * control_compartment : who is the control compartement</span>
<span class="sd">        * mv_max : max M-value for the compartment</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            :depth: (float) -- in meter, the (constant) depth for this segment</span>
<span class="sd">            :time: (float) -- in second, duration of this segment</span>
<span class="sd">            :tank: (Tank) -- object instance of Tank class :</span>
<span class="sd">                             describe the tank used in this segment</span>
<span class="sd">            :setpoint: (float) -- for CCR, setpoint used for this segment</span>
<span class="sd">                                  for OC : setpoint should be zero</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            UnauthorizedMod -- if depth is incompatible</span>
<span class="sd">                               with either min or max mod</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Segment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c">#initiate class logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;dipplanner.segment.SegmentDeco&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;creating an instance of SegmentDeco: </span><span class="se">\</span>
<span class="s">    depth:</span><span class="si">%s</span><span class="s">, time:</span><span class="si">%s</span><span class="s">s, tank:</span><span class="si">%s</span><span class="s">, sp:</span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tank</span><span class="p">,</span> <span class="n">setpoint</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;deco&#39;</span>  <span class="c"># type of segment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_use</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># is this segment in use : default: yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>  <span class="c"># depth of this segment, in meter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>  <span class="c"># time of this segment, in second</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">setpoint</span><span class="p">)</span>  <span class="c"># for CCR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">tank</span>  <span class="c"># tank used for this segment</span>

        <span class="c"># other parameters used in deco mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gf_used</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_compartment</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mv_max</span> <span class="o">=</span> <span class="mf">0.0</span>
</div>
<div class="viewcode-block" id="SegmentDeco.gas_used"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentDeco.gas_used">[docs]</a>    <span class="k">def</span> <span class="nf">gas_used</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;calculates returns the quantity (in liter)</span>
<span class="sd">        of gas used for this segment</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            float -- in liter, quantity of gas used</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pressure</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth_to_pressure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pressure</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">*</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DECO_CONSUMPTION_RATE</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="SegmentAscDesc"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentAscDesc">[docs]</a><span class="k">class</span> <span class="nc">SegmentAscDesc</span><span class="p">(</span><span class="n">Segment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specialisation of segment class for Ascent or Descent segments</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SegmentAscDesc.__init__"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentAscDesc.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_depth</span><span class="p">,</span> <span class="n">end_depth</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">tank</span><span class="p">,</span> <span class="n">setpoint</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for SegmentAscDesc class.</span>
<span class="sd">        Look at base class for more explanations</span>
<span class="sd">        in this segment, we do not specify time, but rate (of ascending</span>
<span class="sd">        or descending) and start_depth and end_depth</span>
<span class="sd">        The comparaison between start and end depth determine if asc or desc</span>
<span class="sd">        rate is given in m/min</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            :start_depth: (float) -- in meter, the starting depth</span>
<span class="sd">                                     for this segment</span>
<span class="sd">            :end_depth: (float) -- in meter, the ending depth</span>
<span class="sd">                                     for this segment</span>
<span class="sd">            :rate: (float) -- in m/s, rate of ascending or descending</span>
<span class="sd">            :tank: (Tank) -- object instance of Tank class :</span>
<span class="sd">                             describe the tank used in this segment</span>
<span class="sd">            :setpoint: (float) -- for CCR, setpoint used for this segment</span>
<span class="sd">                                  for OC : setpoint should be zero</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            UnauthorizedMod -- if depth is incompatible</span>
<span class="sd">                               with either min or max mod</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Segment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c">#initiate class logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;dipplanner.segment.SegmentAscDesc&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;creating an instance of SegmentAscDesc:&quot;</span>
                          <span class="s">&quot;startdepth:</span><span class="si">%s</span><span class="s">, enddepth:</span><span class="si">%s</span><span class="s">, &quot;</span>
                          <span class="s">&quot;rate:</span><span class="si">%s</span><span class="s">s, tank:</span><span class="si">%s</span><span class="s">, sp:</span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="n">start_depth</span><span class="p">,</span>
                           <span class="n">end_depth</span><span class="p">,</span>
                           <span class="n">rate</span><span class="p">,</span>
                           <span class="n">tank</span><span class="p">,</span>
                           <span class="n">setpoint</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">in_use</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># is this segment in use : default: yes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">end_depth</span><span class="p">)</span>  <span class="c"># depth of this segment, in meter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">start_depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">end_depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">setpoint</span><span class="p">)</span>  <span class="c"># for CCR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">tank</span>  <span class="c"># tank used for this segment</span>

        <span class="c"># calculate the time based on start-end depth and rate:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_depth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_depth</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_depth</span> <span class="o">&gt;</span> <span class="n">end_depth</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;ascent&#39;</span>  <span class="c"># type of segment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;descent&#39;</span>
</div>
<div class="viewcode-block" id="SegmentAscDesc.check_mod"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentAscDesc.check_mod">[docs]</a>    <span class="k">def</span> <span class="nf">check_mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_ppo2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;checks the mod for this segment according to the used tank.</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            :max_ppo2: (float) -- max tolerated ppo2</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            UnauthorizedMod -- if segments goes below max mod or upper min mod</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;ascent&#39;</span><span class="p">:</span>
            <span class="n">max_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_depth</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_depth</span>

        <span class="k">if</span> <span class="n">max_depth</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_mod</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">UnauthorizedMod</span><span class="p">(</span><span class="s">&quot;depth is exceeding the maximum MOD&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SegmentAscDesc.check_min_od"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentAscDesc.check_min_od">[docs]</a>    <span class="k">def</span> <span class="nf">check_min_od</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;checks the minimum od for this segment according to the used tank.</span>
<span class="sd">        (hypoxic cases)</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            &lt;nothing&gt;</span>

<span class="sd">        *Raise:*</span>
<span class="sd">            UnauthorizedMod -- if segments goes below max mod or upper min mod</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;ascent&#39;</span><span class="p">:</span>
            <span class="n">min_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_depth</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_depth</span>

        <span class="k">if</span> <span class="n">min_depth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_min_od</span><span class="p">():</span>  <span class="c"># checks mini operating depth</span>
            <span class="k">raise</span> <span class="n">UnauthorizedMod</span><span class="p">(</span><span class="s">&quot;depth is too low for the minimum MOD&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SegmentAscDesc.gas_used"><a class="viewcode-back" href="../../autodoc.html#dipplanner.segment.SegmentAscDesc.gas_used">[docs]</a>    <span class="k">def</span> <span class="nf">gas_used</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;calc. and returns the quantity (in liter) of gas used</span>
<span class="sd">        in this segment because it&#39;s ascend or descent,</span>
<span class="sd">        the gas is not used at the same rate during the segment</span>
<span class="sd">        Because the rate is the same during all the segment, we can use the</span>
<span class="sd">        consumption at the average depth of the segment</span>

<span class="sd">        *Keyword arguments:*</span>
<span class="sd">            &lt;none&gt;</span>

<span class="sd">        *Returns:*</span>
<span class="sd">            float -- in liter, quantity of gas used</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">average_depth</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_depth</span><span class="p">)</span> <span class="o">+</span>
                             <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_depth</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">pressure</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth_to_pressure</span><span class="p">(</span><span class="n">average_depth</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">AMBIANT_PRESSURE_SURFACE</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pressure</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">*</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DIVE_CONSUMPTION_RATE</span><span class="p">))</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">dipplanner 0.3a-11-gcf71 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../dipplanner.html" >dipplanner</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2012, Thomas Chiroux.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>